import{S as C}from"./sweetalert2.all-6567ce3e.js";import{L as w}from"./index-15c07a51.js";import{M as x,D}from"./DeleteModal-dadc9a16.js";import{_ as V,r as p,o as i,c as d,b as e,d as l,w as L,n as g,j as v,v as $,I as E,F as M,i as N,e as y,t as m}from"./index-ea9b93d2.js";import{P as S}from"./PaginationComponent-bf1a6b6f.js";import"./_commonjsHelpers-042e6b4d.js";const T={props:["isNew","coupon"],data(){return{tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon;const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T")[0];this.due_date=n},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new x(this.$refs.modal)}},U={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog"},I={class:"modal-content"},P={class:"modal-header"},R={class:"modal-title fs-5",id:"staticBackdropLabel"},B={key:0},A={key:1},O=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},j={class:"mb-3"},H=e("label",{for:"title",class:"form-label"},"標題",-1),z={class:"mb-3"},G=e("label",{for:"percent",class:"form-label"},"百分比",-1),J={class:"mb-3"},K=e("label",{for:"due_date",class:"form-label"},"到期日",-1),Q=["min"],W={class:"mb-3"},X=e("label",{for:"code",class:"form-label"},"優惠碼",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),oe=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 關閉 "),e("button",{type:"submit",class:"btn btn-primary"},"確定")],-1);function te(n,o,h,k,t,a){const u=p("VField"),c=p("ErrorMessage"),f=p("VForm");return i(),d("div",U,[e("div",F,[e("div",I,[e("div",P,[e("h2",R,[h.isNew?(i(),d("span",B,"新增優惠券")):(i(),d("span",A,"編輯優惠券"))]),O]),e("div",q,[l(f,{onSubmit:o[5]||(o[5]=()=>n.$emit("update"))},{default:L(({errors:r})=>[e("div",j,[H,l(u,{type:"text",id:"title",name:"標題",class:g(["form-control",{"is-invalid":r.標題}]),modelValue:t.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=s=>t.tempCoupon.title=s),placeholder:"輸入標題",rules:"required"},null,8,["class","modelValue"]),l(c,{name:"標題",class:"invalid-feedback"})]),e("div",z,[G,l(u,{type:"number",name:"百分比",class:g(["form-control",{"is-invalid":r.百分比}]),id:"percent",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":o[1]||(o[1]=s=>t.tempCoupon.percent=s),modelModifiers:{number:!0},placeholder:"輸入百分比",rules:"required"},null,8,["class","modelValue"]),l(c,{name:"百分比",class:"invalid-feedback"})]),e("div",J,[K,v(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=s=>t.due_date=s),min:new Date().toISOString().split("T")[0]},null,8,Q),[[$,t.due_date]])]),e("div",W,[X,l(u,{type:"text",name:"優惠碼",class:g(["form-control",{"is-invalid":r.優惠碼}]),id:"code",modelValue:t.tempCoupon.code,"onUpdate:modelValue":o[3]||(o[3]=s=>t.tempCoupon.code=s),placeholder:"輸入優惠碼",rules:"required"},null,8,["class","modelValue"]),l(c,{name:"優惠碼",class:"invalid-feedback"})]),e("div",Y,[e("div",Z,[ee,v(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=s=>t.tempCoupon.is_enabled=s),"true-value":1,"false-value":0},null,512),[[E,t.tempCoupon.is_enabled]])])]),oe]),_:1})])])])],512)}const se=V(T,[["render",te]]),{VITE_URL:_,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"youting",BASE_URL:"/cafe-ecommerce/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ne={data(){return{isNew:!0,isLoading:!1,coupons:[],tempCoupon:{},pagination:{},bsModal:""}},components:{CouponModal:se,DeleteModal:D,Pagination:S,Loading:w},methods:{getCoupon(n=1){this.isLoading=!0,this.$http.get(`${_}/v2/api/${b}/admin/coupons?page=${n}`).then(o=>{this.coupons=o.data.coupons,this.pagination=o.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,this.$router.push("/login")})},openCouponModal(n,o){n?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.isNew=!0):(this.tempCoupon={...o},this.isNew=!1),this.bsModal=this.$refs.couponModal,this.bsModal.openModal()},updateCoupon(){let n=`${_}/api/${b}/admin/coupon`,o="post";if(this.isNew||(n=`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`,o="put"),this.tempCoupon.percent<0||this.tempCoupon.percent>100){C.fire({icon:"error",title:"請重試一次",text:"請勿為負值或大於一百"});return}this.$http[o](n,{data:this.tempCoupon}).then(()=>{this.getCoupon()}).catch(h=>{C.fire({icon:"error",title:"請重試一次",text:h.response.data.message})}),this.bsModal.hideModal()},openRemoveModal(n){this.tempCoupon={...n},this.bsModal=this.$refs.delModal,this.bsModal.openModal()},removeCoupon(){this.$http.delete(`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(()=>{this.getCoupon()}).catch(n=>{C.fire({icon:"error",title:"請重試一次",text:n.response.data.message})}),this.bsModal.hideModal()}},computed:{dueDate(){return n=>new Date(n*1e3).toLocaleDateString()}},mounted(){this.getCoupon()}},le={class:"text-end mt-4"},ae=e("h2",null,"優惠券列表",-1),ie={class:"table table-hover mt-4 align-middle"},de=e("thead",null,[e("tr",null,[e("th",null,"優惠券名稱"),e("th",null,"折價百分比"),e("th",null,"code"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯優惠券")])],-1),pe={key:0,class:"text-success"},ue={key:1},ce={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},re=["onClick"],me=["onClick"],he={class:"d-flex justify-content-center"};function _e(n,o,h,k,t,a){const u=p("loading"),c=p("Pagination"),f=p("DeleteModal"),r=p("CouponModal");return i(),d(M,null,[e("div",null,[l(u,{active:t.isLoading,loader:"dots",color:"#FCF8F3","background-color":"#676767"},null,8,["active"]),e("div",le,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=()=>a.openCouponModal(!0))}," 建立新的優惠券 ")]),ae,e("table",ie,[de,e("tbody",null,[(i(!0),d(M,null,N(t.coupons,s=>(i(),d("tr",{key:s.id},[e("td",null,m(s.title),1),e("td",null,m(s.percent),1),e("td",null,m(s.code),1),e("td",null,m(a.dueDate(s.due_date)),1),e("td",null,[s.is_enabled?(i(),d("span",pe,"啟用")):(i(),d("span",ue,"未啟用"))]),e("td",null,[e("div",ce,[e("button",{type:"button",class:"btn btn-secondary",onClick:()=>a.openCouponModal(!1,s)}," 編輯 ",8,re),e("button",{type:"button",class:"btn btn-outline-danger",onClick:()=>a.openRemoveModal(s)}," 刪除 ",8,me)])])]))),128))])]),e("p",null,[y(" 目前有 "),e("span",null,m(t.coupons.length),1),y(" 項優惠券 ")]),e("div",he,[l(c,{pagination:t.pagination,onEmitPage:a.getCoupon},null,8,["pagination","onEmitPage"])])]),l(f,{ref:"delModal",product:t.tempCoupon,onRemoveItem:a.removeCoupon},null,8,["product","onRemoveItem"]),l(r,{ref:"couponModal",isNew:t.isNew,coupon:t.tempCoupon,onUpdate:a.updateCoupon},null,8,["isNew","coupon","onUpdate"])],64)}const ye=V(ne,[["render",_e]]);export{ye as default};
