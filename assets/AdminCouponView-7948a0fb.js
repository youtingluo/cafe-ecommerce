import{L as w}from"./index-54b2cda4.js";import{M as x,D}from"./DeleteModal-fc55a5bf.js";import{_ as g,o as d,c as i,b as o,j as p,v as r,I as $,r as m,d as h,F as f,i as L,e as C,t as u}from"./index-dea600ad.js";import{P as V}from"./PaginationComponent-6e528c57.js";import"./_commonjsHelpers-042e6b4d.js";const N={props:["isNew","coupon"],data(){return{tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon;const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T")[0];this.due_date=n},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new x(this.$refs.modal)}},E={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog"},U={class:"modal-content"},P={class:"modal-header"},R={class:"modal-title fs-5",id:"staticBackdropLabel"},I={key:0},S={key:1},B=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},A={class:"mb-3"},O=o("label",{for:"title",class:"form-label"},"標題",-1),j={class:"mb-3"},H=o("label",{for:"percent",class:"form-label"},"百分比",-1),q={class:"mb-3"},z=o("label",{for:"due_date",class:"form-label"},"到期日",-1),G={class:"mb-3"},J=o("label",{for:"code",class:"form-label"},"優惠碼",-1),K={class:"mb-3"},Q={class:"form-check"},W=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),X={class:"modal-footer"},Y=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"關閉",-1);function Z(n,e,c,v,t,l){return d(),i("div",E,[o("div",T,[o("div",U,[o("div",P,[o("h2",R,[c.isNew?(d(),i("span",I,"新增產品")):(d(),i("span",S,"編輯產品"))]),B]),o("div",F,[o("div",A,[O,p(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=s=>t.tempCoupon.title=s),placeholder:"輸入標題"},null,512),[[r,t.tempCoupon.title]])]),o("div",j,[H,p(o("input",{type:"number",class:"form-control",id:"percent","onUpdate:modelValue":e[1]||(e[1]=s=>t.tempCoupon.percent=s),placeholder:"輸入百分比"},null,512),[[r,t.tempCoupon.percent,void 0,{number:!0}]])]),o("div",q,[z,p(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=s=>t.due_date=s)},null,512),[[r,t.due_date]])]),o("div",G,[J,p(o("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":e[3]||(e[3]=s=>t.tempCoupon.code=s),placeholder:"輸入優惠碼"},null,512),[[r,t.tempCoupon.code]])]),o("div",K,[o("div",Q,[W,p(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>t.tempCoupon.is_enabled=s),"true-value":1,"false-value":0},null,512),[[$,t.tempCoupon.is_enabled]])])])]),o("div",X,[Y,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=s=>n.$emit("update"))},"確定")])])])],512)}const oo=g(N,[["render",Z]]),{VITE_URL:_,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"youting",BASE_URL:"/cafe-ecommerce/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},eo={data(){return{isNew:!0,isLoading:!1,coupons:[],tempCoupon:{},pagination:{},bsModal:""}},components:{CouponModal:oo,DeleteModal:D,Pagination:V,Loading:w},methods:{getCoupon(n=1){this.isLoading=!0,this.$http.get(`${_}/v2/api/${b}/admin/coupons?page=${n}`).then(e=>{this.coupons=e.data.coupons,this.pagination=e.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,this.$router.push("/login")})},openCouponModal(n,e){n?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.isNew=!0):(this.tempCoupon={...e},this.isNew=!1),this.bsModal=this.$refs.couponModal,this.bsModal.openModal()},updateCoupon(){let n=`${_}/api/${b}/admin/coupon`,e="post";this.isNew||(n=`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.$http[e](n,{data:this.tempCoupon}).then(()=>{this.getCoupon()}).catch(c=>{alert(c.message)}),this.bsModal.hideModal()},openRemoveModal(n){this.tempCoupon={...n},this.bsModal=this.$refs.delModal,this.bsModal.openModal()},removeCoupon(){this.$http.delete(`${_}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(()=>{this.getCoupon()}).catch(n=>{alert(n.response.data.message)}),this.bsModal.hideModal()}},computed:{dueDate(){return n=>new Date(n*1e3).toLocaleDateString()}},mounted(){this.getCoupon()}},to={class:"text-end mt-4"},no=o("h2",null,"優惠券列表",-1),so={class:"table table-hover mt-4 align-middle"},lo=o("thead",null,[o("tr",null,[o("th",null,"優惠券名稱"),o("th",null,"折價百分比"),o("th",null,"code"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯產品")])],-1),ao={key:0,class:"text-success"},io={key:1},po={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},uo=["onClick"],co=["onClick"],ro={class:"d-flex justify-content-center"};function mo(n,e,c,v,t,l){const s=m("loading"),M=m("Pagination"),y=m("DeleteModal"),k=m("CouponModal");return d(),i(f,null,[o("div",null,[h(s,{active:t.isLoading,loader:"dots",color:"#FCF8F3","background-color":"#676767"},null,8,["active"]),o("div",to,[o("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=()=>l.openCouponModal(!0))}," 建立新的優惠券 ")]),no,o("table",so,[lo,o("tbody",null,[(d(!0),i(f,null,L(t.coupons,a=>(d(),i("tr",{key:a.id},[o("td",null,u(a.title),1),o("td",null,u(a.percent),1),o("td",null,u(a.code),1),o("td",null,u(l.dueDate(a.due_date)),1),o("td",null,[a.is_enabled?(d(),i("span",ao,"啟用")):(d(),i("span",io,"未啟用"))]),o("td",null,[o("div",po,[o("button",{type:"button",class:"btn btn-secondary",onClick:()=>l.openCouponModal(!1,a)}," 編輯 ",8,uo),o("button",{type:"button",class:"btn btn-outline-danger",onClick:()=>l.openRemoveModal(a)}," 刪除 ",8,co)])])]))),128))])]),o("p",null,[C(" 目前有 "),o("span",null,u(t.coupons.length),1),C(" 項優惠券 ")]),o("div",ro,[h(M,{pagination:t.pagination,onEmitPage:l.getCoupon},null,8,["pagination","onEmitPage"])])]),h(y,{ref:"delModal",product:t.tempCoupon,onRemoveItem:l.removeCoupon},null,8,["product","onRemoveItem"]),h(k,{ref:"couponModal",isNew:t.isNew,coupon:t.tempCoupon,onUpdate:l.updateCoupon},null,8,["isNew","coupon","onUpdate"])],64)}const go=g(eo,[["render",mo]]);export{go as default};
